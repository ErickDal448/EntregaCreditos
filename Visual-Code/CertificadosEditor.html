<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Créditos-Certificados-Editor</title>

    <link rel="stylesheet" href="style.css"/>
    <link rel="stylesheet" href="own-style.css"/> 
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3&display=swap" rel="stylesheet">

</head>
<body>
    <header>
        <!-- navbar resposiva -->
       <nav class="navbar bg-cabeza bg-body-tertiary">
           <div class="container-fluid" style="flex-wrap: nowrap;">
               <a class="navbar-brand  col-md-6" href="#" id="cabeza-a">
                   <img src="Imagenes/LogoUAS.png" alt="Logo" id="logoUAS">
                   <div class="p-logoUAS">
                       <p>Módulo de créditos</p><p>Extracurriculares</p>
                   </div>           
               </a>
               <div class="nav-item col-md-6" id="div-menu" >
                    <ul class="navbar-nav me-auto mb-lg-0 col-md-12" ID="header-lista" >
                        <li class="nav-text">
                            <a class="nav-link" href="InicioEditor.html">INICIO</a>
                        </li>
                        <li class="nav-text">
                            <a class="nav-link" href="EventosEditor.html">EVENTOS</a>
                        </li>
                        <li class="nav-text">
                            <a class="nav-link text-pulsar">CERTIFICADOS</a>
                        </li>
                        <li class="nav-text nav-fondo">
                            <a class="nav-link" href="PerfilEditor.html">PERFIL</a>
                        </li>
                        <li>
                            <a href="Perfil.html">
                                <img src="Imagenes/IconPerfil.png" alt="Icono de perfil">
                            </a>
                        </li>
                    </ul>
                    <li class="nav-item dropdown  col-md-12" id="li-dropdown">
                        <a class="nav-link dropdown-toggle text-fondo" id="Dropdown" data-bs-toggle="dropdown" href="#" role="button" aria-expanded="false"><span class="navbar-toggler-icon"></span></a>
                        <ul class="dropdown-menu" id="drop-menu">
                            <li><a class="dropdown-item" href="InicioEditor.html">INICIO</a></li>
                            <li><a class="dropdown-item" href="EventosEditor.html">EVENTOS</a></li>
                            <li><a class="dropdown-item disabled text-fondo bg-pulsar" href="">CERTIFICADOS</a></li>
                            <li><a class="dropdown-item" href="PerfilEditor.html">PERFIL</a></li>
                        </ul>
                    </li>
                </div>
            </div>
        </nav>
   </header>
    
   <section class="container-fluid" id="section-info-inicio">
    <div class="card" id="card-eventos">
        <section class="filtrosCertificado" id="Field1CertificadosEdit">
              <select class="form-select form-select-lg mb-3 bg-pulsar text-fondo col-md-6" aria-label=".form-select-lg example" style="font-weight: 600; border-radius: 60px;" id="SeleccionFiltrosCertificados">
                <option value="0">Seleccione que certificados ver...</option>
                <option value="1">Certificados Por Revisar</option>
                <option value="2">Certificados Revisados</option>
              </select>
        </section>

        <section class="Eventos-ListaSimple">
            <div class="card" id="card-lista-eventosSimple">
                
            </div>


        </section>

        <section class="EventosTablas" id="Field1-5CertificadosEdit" style="display: none;"> 
            <div class="card" id="card-lista-eventos">
                <div class="mapa-creditos col-md-2" style="margin-top: 20px;">
                    <button class="btn btn-cancelar text-fondo" id="btnReturn" onclick="regresar()" style="border-radius: 40px; width: 90px; height: 60px; margin-bottom: 30px;"> 
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-left" viewBox="0 0 16 16" style="width: 40px; height: 40px;">
                            <path fill-rule="evenodd" d="M6 12.5a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v2a.5.5 0 0 1-1 0v-2A1.5 1.5 0 0 1 6.5 2h8A1.5 1.5 0 0 1 16 3.5v9a1.5 1.5 0 0 1-1.5 1.5h-8A1.5 1.5 0 0 1 5 12.5v-2a.5.5 0 0 1 1 0v2z"/>
                            <path fill-rule="evenodd" d="M.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L1.707 7.5H10.5a.5.5 0 0 1 0 1H1.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
                        </svg>
                    </button>
                    <div class="badge bg-light text-wrap text-dark font-weight-bold fs-6" style="margin-bottom: 0px; border-radius: 50px;">
                        Ir al documento:
                    </div>
                    <a href="" target="_blank" id="enlace-drive" style="margin-top: 5px;">
                        <button class="btn btn-cabeza" id="BotonMapa" type="button" data-bs-toggle="collapse" data-bs-target="#collapseWidthExample" aria-expanded="false" aria-controls="collapseWidthExample">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-file-earmark" viewBox="0 0 16 16">
                                <path d="M14 4.5V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h5.5L14 4.5zm-3 0A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4.5h-2z"/>
                              </svg>
                        </button>
                    </a>
                    <div class="badge bg-pulsar text-wrap font-weight-bold fs-6" style="margin-bottom: 20px; border-radius: 50px;" id="EnvioCreditos">
                        
                    </div>
                </div>
                

                <div class="col-md-9" id="lista-info-evento">
                    <div class="divBtnEditar">
                        <button class="btn btn-pulsar text-fondo" id="btnEditar"> Dar nota </button>
                    </div>
                    <ul class="list-group list-group-horizontal ">
                        <li class="list-group-item AtributosCertificados ">Estudiante</li>
                        <li class="list-group-item VariablesCertificados" id="EnvioEstudiante">{Nombre}</li>
                    </ul>
                    <ul class="list-group list-group-horizontal ">
                        <li class="list-group-item AtributosCertificados ">Título</li>
                        <li class="list-group-item VariablesCertificados" id="EnvioTitulo"></li>
                    </ul>
                    <ul class="list-group list-group-horizontal">
                        <li class="list-group-item AtributosCertificados">Tipo</li>
                        <li class="list-group-item VariablesCertificados" id="EnvioNombreTC"></li>
                    </ul>
                    <ul class="list-group list-group-horizontal">
                        <li class="list-group-item AtributosCertificados">Fecha</li>
                        <input type="datetime-local" class="form-control  VariablesCertificados" style="width: auto;border-bottom-left-radius: 0px;border-top-left-radius: 0px;" id="EnvioFecha" name="fecha-hora" readonly>
                    </ul>
                    <ul class="list-group list-group-horizontal">
                        <li class="list-group-item AtributosCertificados">Estado</li>
                        <li class="list-group-item VariablesCertificados" id="EnvioEstado"></li>
                    </ul>
                    <ul class="list-group list-group-horizontal">
                        <li class="list-group-item AtributosCertificados">Comentario</li>
                        <li class="list-group-item VariablesCertificados text-break" id="EnvioComentario"></li>
                    </ul>
                    
                </div>
            </div>

            <script>
                let SelectElement = document.getElementById('SeleccionFiltrosCertificados');
                SelectElement.addEventListener("change", function() {
                    //Obtener filtro
                    let filtro = SelectElement.value;
                    if(filtro == "1" || filtro == "2"){
                        if(filtro == "2"){
                            filtro = "CertificadosYaRevisados";
                        }
                        if(filtro == "1"){
                            filtro = "CertificadosPorRevisar";
                        }
                        // Obtener los datos de los eventos desde la API utilizando el filtro seleccionado
                        fetch(`https://localhost:7220/api/Certificados/` + filtro + `?Institucion=${encodeURIComponent(localStorage.getItem('UserInstitucion'))}`)
                        .then(response => response.json())
                        .then(envios => {
                            // Generar el contenido de la sección Eventos-ListaSimple
                            let envioListaSimple = document.querySelector(".Eventos-ListaSimple");
                            envioListaSimple.style.display = "block";
                            envioListaSimple.innerHTML = "";
        
                            for (let envio of envios) {
                                let envioElement = document.createElement("div");
                                envioElement.className = "card";
                                envioElement.id = "card-lista-eventosSimple";
                                envioElement.onclick = function() {
                                MostrarInfoCertificados(envio.idEnvio);
                                console.log(envio.idEnvio);
                                };
                                envioElement.innerHTML = `
                                <div class="col-md-11" data-id="${envio.idEnvio}" id="lista-info-eventoSimple">
                                    <ul class="list-group list-group-horizontal ">
                                        <li class="list-group-item AtributosEventos">Título</li>
                                        <li class="list-group-item VariablesEventos text-break">${envio.tituloCertificado}</li>
                                    </ul>
                                    <ul class="list-group list-group-horizontal ">
                                        <li class="list-group-item AtributosEventos">Fecha</li>
                                        <li class="list-group-item VariablesEventos text-break">${envio.fecha}</li>
                                    </ul>
                                    <ul class="list-group list-group-horizontal ">
                                        <li class="list-group-item AtributosEventos">Estado</li>
                                        <li class="list-group-item VariablesEventos text-break">${envio.estado}</li>
                                    </ul>
                                </div>
                                `;
                                envioListaSimple.appendChild(envioElement);
                            }
                        });
                    }
                    
                    if(filtro == "0"){
                        let eventosListaSimple = document.querySelector(".Eventos-ListaSimple");
                        eventosListaSimple.style.display = "none";
                    }
                });
                var EnvioGlobal = 0;
                function MostrarInfoCertificados(idEnvio) {
                    document.getElementById("card-lista-eventosSimple").style.display = "none";
                    Field1.style.display = 'none';
                    Field1_5.style.display = "flex";
                    // Obtener los detalles del evento con el ID especificado desde la API
                    console.log(idEnvio + " Check");
                    EnvioGlobal = idEnvio;
                    fetch("https://localhost:7220/api/Certificados/CertificadosInfo?idEvento=" + idEnvio)
                        .then(response => response.json())
                        .then(envio => {
            
                            console.log(envio);
                            // Mostrar la información detallada del evento
                            let listaSimpleElements = document.querySelectorAll(".Eventos-ListaSimple");
                            for (let element of listaSimpleElements) {
                            element.style.display = "none";
                            }
                            document.getElementById("card-lista-eventos").style.display = "flex";
            
                            // Actualizar el contenido de la sección con la información detallada del evento
                            document.getElementById("enlace-drive").href = envio[0].drive;
                            document.getElementById("EnvioCreditos").textContent = "Créditos= " + envio[0].creditos;
                            document.getElementById("EnvioTitulo").textContent = envio[0].tituloCertificado;
                            document.getElementById("EnvioNombreTC").textContent = envio[0].nombreTC;
                            document.getElementById("EnvioComentario").textContent = envio[0].comentario;
                            document.getElementById("EnvioEstado").textContent = envio[0].estado;
                            document.getElementById("EnvioFecha").value = envio[0].fecha;
                            document.getElementById("EnvioEstudiante").textContent = envio[0].nombre + " " + envio[0].apellidos;
                        });
                }
           </script>
        </section>

        <section class="EnviarCertificado" id="Field2CertificadosEdit" style="display: none">
            <div class="card" id="card-Enviar-certificado" style="padding: 50px;">
                <div class="divBtnSalirEnviarCert">
                    <button class="btn btn-cabeza text-fondo" id="btnExitPostCert"> 
                        <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="#EE8F89" class="bi bi-x-circle" viewBox="0 0 16 16">
                            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                            <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
                          </svg>
                    </button>
                </div>
                
                <div class="mb-3">
                <label for="formGroupExampleInput2" class="form-label font-weight-bold">Estado</label>
                <select id="seleccionEstado" class="form-select bg-pulsar text-fondo">
                    <option value="0">Estado de certificado</option>
                    <option value="1">Aceptado</option>
                    <option value="2">Rechazado</option>
                </select>
                </div>
                <label for="formGroupExampleInput" class="form-label font-weight-bold ">Comentario</label>
                <textarea class="form-control" aria-label="With textarea" style="border-radius: 40px; background-color: antiquewhite; height: 150px; padding: 10px;" id="PonerComentario"></textarea>
                <div class="divBtnSendEnviarCert">
                    <button class="btn btn-cabeza text-fondo" id="btnSendPostCert"> 
                        ENVIAR
                    </button>
                </div>
            </div>
            <script>
                document.getElementById("btnSendPostCert").addEventListener("click", function() {
                    // Obtener los valores de los campos del formulario
                    let estado = document.getElementById("seleccionEstado").value;
                    let comentario = document.getElementById("PonerComentario").value;

                    if(estado == "1" || estado == "2")
                    {
                        if(estado == "1"){
                            estado="Aceptado";
                        }
                        if(estado == "2"){
                            estado = "Rechazado";
                        }
                        // Crear el objeto JSON con los datos a enviar
                        let data = {
                            estado: estado,
                            comentario: comentario
                        };

                        // Enviar la solicitud PUT a la API
                        fetch("https://localhost:7220/api/Certificados/ActualizarCertificadoEnviado?idEnvio=" + EnvioGlobal, {
                            method: "PUT",
                            headers: {
                            "Content-Type": "application/json"
                            },
                            body: JSON.stringify(data)
                        })
                        .then(response => response.json())
                        .then(data => console.log(data))
                        .catch(error => console.error(error));

                        Field2.style.display = 'none'; // cambia el valor de display a flex
                        document.getElementById("card-lista-eventosSimple").style.display = "flex";
                        Field1.style.display = 'flex';
                        SelectElement.value = "0";
                    }
                    if(estado == "0"){
                        alert("Favor de seleccionar el estado del certificado");
                    }
                });

            </script>
        </section>
    </div>  
</section>


<script src="js/functions.js"></script>
<script>document.write('<script src="' + getBootstrapBundlePath() + '"><\/script>');</script>
<script>
    let Field1 = document.getElementById('Field1CertificadosEdit');
    let Field1_5 = document.getElementById('Field1-5CertificadosEdit');
    let Field2 = document.getElementById('Field2CertificadosEdit');
    let BtnEditar = document.getElementById('btnEditar');
    let Salir = document.getElementById('btnExitPostCert');

    function MostrarInfo(){
        document.getElementById("card-lista-eventosSimple").style.display = "none";
        Field1.style.display = 'none';
        Field1_5.style.display = "flex";
    }  
    function regresar(){
        document.getElementById("card-lista-eventosSimple").style.display = "flex";
        Field1_5.style.display = "none";
        Field1.style.display = 'flex';
        SelectElement.value = "0";
    }

    BtnEditar.addEventListener('click', () => {
        Field2.style.display = 'flex'; // cambia el valor de display a flex
        Field1.style.display = 'none';
        Field1_5.style.display = 'none';
    });

    Salir.addEventListener('click', () => {
        Field2.style.display = 'none'; // cambia el valor de display a flex
        document.getElementById("card-lista-eventosSimple").style.display = "none";
        Field1.style.display = 'none';
        Field1_5.style.display = "flex";
    });
</script>
</body>
</html>